<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="roomdoo_menu_link_active" inherit_id="website.submenu">
        <xpath expr="//a[@t-att-href='submenu.clean_url()']" position="attributes">
            <attribute name="t-attf-class">#{link_class or ''} #{'active' if submenu.clean_url() and unslug_url(request.httprequest.path) == unslug_url(submenu.clean_url()) or submenu.clean_url() == '/reservation/list' and unslug_url(request.httprequest.path).startswith('/reservation/') else ''}</attribute>
        </xpath>
    </template>
    <template id="roomdoo_reservation_detail" name="Reservation detail">
        <t t-call="website.layout">
            <t t-set="page_title" t-value="'Reservation detail'" />
            <t t-call="pms_pwa.o_pms_pwa_edit_modal" />
            <input type="hidden" name="reservation_id" t-attf-value="{{ reservation.id }}" />
            <div class="o_pms_pwa_roomdoo_reservation_modal" />
            <div class="o_pms_pwa_notifications o_pms_pwa_notifications_regular mt-2">
                <span class="o_pms_notification_title">
                    <i class="fa fa-info-circle mr-1" />
                    Updates
                    <span class="o_pms_pwa_update_counter ml-1" />
                </span>
            </div>
            <div class="o_pms_pwa_roomdoo_alerts" />
            <div id="o_pms_detail_reservation" class="oe_structure o_pms_pwa_structure mt-2">
                <section class="container-fluid o_pms_pwa_roomdoo">
                    <div class="justify-content-center ">
                        <div class="row ">
                            <div class="col-lg-12 col-xl-6">
                                <h1>
                                    <span class="title-header">Reserva</span>
                                    <span class="blue-header">
                                        <t t-esc="reservation.name" />
                                    </span>
                                    <span class="agency">
                                        <img t-if="reservation.agency_id" t-att-src="website.image_url(reservation.agency_id, 'image_128')" width="100" t-att-title="reservation.agency_id.name" t-att-alt="reservation.agency_id.name" />
                                        <span t-else="">
                                            <span t-if="reservation.channel_type_id" t-esc="reservation.channel_type_id.name" />
                                            <span t-if="reservation.channel_type_id" class="o_pms_pwa_wler ml-2" t-esc="reservation.partner_id.name" />
                                        </span>

                                    </span>
                                    <span class="status-header">
                                        <t t-esc="reservation.state" />
                                    </span>
                                </h1>
                            </div>
                            <div class="col-lg-12 col-xl-6 text-right o_pms_pwa_keypad_footer">
                                <button id="o_pms_pwa_button_cancel" t-attf-url="/reservation/{{ reservation.id }}/cancel" class="btn btn-grey-900 btn-radius o_pms_pwa_button_cancel o_pms_pwa_btn_principal">Cancelar reserva</button>
                                <button id="o_pms_pwa_button_checkin" class="btn btn-grey-300 btn-radius o_pms_pwa_button_checkin o_pms_pwa_disabled">Check in</button>
                                <button id="o_pms_pwa_button_checkout" t-attf-url="/reservation/{{ reservation.id }}/checkout" class="btn btn-grey-300 btn-radius o_pms_pwa_button_checkout o_pms_pwa_disabled">Check out</button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 col-xl-4  mt-4">
                                <div class="card shadow">
                                    <div class="container-fluid">
                                        <div class="bg-dark">
                                            <div class="row">
                                                <div class="col-12">
                                                    <img class="ml-4 my-4 rounded-circle img-fluid o_pms_pwa_img_rounded" t-att-src="website.image_url(reservation.partner_id, 'image_128')" t-att-title="reservation.partner_id.name" t-att-alt="reservation.partner_id.name" width="100" />
                                                </div>
                                                <div class="col-12">
                                                    <h3 class="text-white ml-4">
                                                        <t t-esc="reservation.partner_id.name" />
                                                    </h3>
                                                    <p class="ml-4 mb-0">
                                                        <a t-attf-href="tel:{{reservation.partner_phone}}" class="text-white">
                                                            <t t-esc="reservation.partner_phone" />
                                                        </a>
                                                    </p>
                                                    <p class="ml-4">
                                                        <a t-attf-href="mailto:{{reservation.partner_email}}" class="text-white font-italic">
                                                            <t t-esc="reservation.partner_email" />
                                                        </a>
                                                    </p>
                                                </div>
                                            </div>
                                            <div clas="row">
                                                <div class="col-12">
                                                    <div class="progress o_pms_pwa_progress mx-2">
                                                        <div t-att-class="'progress-bar '
                                                            + ('bg-success ' if reservation.state in ('onboard') else ' ')
                                                            + ('bg-light ' if reservation.state in ('done', 'cancelled', 'no_show', 'no_checkout') else ' ')
                                                            + ('bg-success ' if reservation.state in ('confirm') and reservation.ratio_checkin_data &gt; 75 else ' ')
                                                            + ('bg-warning ' if reservation.state in ('confirm') and  75 &gt; reservation.ratio_checkin_data &gt; 50 else ' ')
                                                            + ('bg-danger ' if reservation.state in ('confirm') and  reservation.ratio_checkin_data &lt; 50 else ' ')" role="progressbar" t-att-style="'width:'+ str(reservation.checkins_ratio if reservation.state in ('onboard') else reservation.ratio_checkin_data) + '%'" t-att-aria-valuenow="reservation.checkins_ratio if reservation.state in ('onboard') else reservation.ratio_checkin_data" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                    <div class="dropdown mx-2">
                                                        <button class="btn btn-persona-info dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                            <span data-toggle="tooltip" title="Huéspedes" class="badge bg-red mr-2" data-original-title="Huéspedes">
                                                                <t t-esc="reservation.adults" />
                                                            </span>
                                                            Datos personales huéspedes
                                                        </button>
                                                        <div class="dropdown-menu btn-persona-info-item" aria-labelledby="dropdownMenuButton">
                                                            <t t-foreach="reservation.checkin_partner_ids" t-as="person">
                                                                <a class="dropdown-item o_pms_pwa_button_checkin" href="#">
                                                                    <t t-if="person.partner_id.name">
                                                                        <t t-esc="person.partner_id.name" />
                                                                    </t>
                                                                    <t t-else="">
                                                                        No indicado
                                                                    </t>
                                                                </a>
                                                            </t>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="box o_pms_pwa_direct_chat o_pms_pwa_direct_chat_warning">
                                            <!-- <div class="box-header with-border">
                                                <h3 class="box-title">Mensajes</h3>
                                                <div class="box-tools pull-right">
                                                    <span data-toggle="tooltip" title="New Messages" class="badge o_pms_pwa_bg_blue" data-original-title="New Messages"><t t-esc="reservation.message_unread_counter"></t></span>
                                                </div>
                                            </div> -->
                                            <div id="o_pms_pwa_direct_chat_messages" class="box-body">
                                                <div class="o_pms_pwa_direct_chat_messages">
                                                    <t t-set="mesage_date" t-value="[]" />
                                                    <t t-foreach="reservation.message_ids.sorted(key=lambda x: x.date)" t-as="msg">
                                                        <t t-if="msg.date not in mesage_date" t-set="mesage_date" t-value="mesage_date+[msg.date]" />
                                                    </t>
                                                    <t t-foreach="mesage_date" t-as="date">
                                                        <div class="o_pms_pwa_direct_chat_timestamp text-center">
                                                            <strong t-esc="date" t-esc-options='{"format": "%d %B %Y"}'/>
                                                        </div>
                                                        <t t-foreach="reservation.message_ids.sorted(key=lambda x: x.date)" t-as="msg">
                                                            <t t-if="date==msg.date">
                                                                <div class="o_pms_pwa_direct_chat_msg m-2">
                                                                    <div class="o_pms_pwa_direct_direct_chat_info clearfix">
                                                                        <span class="pull-left">
                                                                            <img class="o_pms_pwa_direct_chat_img rounded-circle img-fluid" t-att-src="website.image_url(msg.author_id, 'image_128')" t-att-title="reservation.partner_id.name" t-att-alt="reservation.partner_id.name" />
                                                                            <strong class="ml-2">
                                                                                <t t-esc="msg.author_id.name"></t>
                                                                            </strong>
                                                                        </span>
                                                                        <span class="o_pms_pwa_direct_chat_timestamp pull-right">
                                                                            <span t-field="msg.date" t-options='{"format": "H:s"}' />
                                                                        </span>
                                                                    </div>

                                                                    <div class="o_pms_pwa_direct_chat_text">
                                                                        <span t-field="msg.body" options="{'style-inline': true}" />
                                                                    </div>
                                                                </div>
                                                            </t>
                                                        </t>
                                                    </t>
                                                </div>
                                            </div>
                                            <div class="box-footer text-center">
                                                <form action="/reservation/82" method="post">
                                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                                                    <input type="hidden" name="model" value="pms.reservation" />
                                                    <input type="hidden" name="id" t-att-value="reservation.id" />
                                                    <input type="hidden" name="folio_id" t-att-value="reservation.folio_id.id" />
                                                    <div class="form-group">
                                                        <input type="text" name="message" placeholder="Escribe..." class="form-control message-input" required="" />
                                                        <input type="submit" class="btn btn-message" value="Enviar" />
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12 col-xl-4 mt-4" id="folio_reservation_ids">

                                <div t-if="reservation.folio_id.number_of_rooms > 1" class="card mb-4 shadow">
                                    <div class="o_pms_pwa_table_reservation_list m-4">
                                        <table class="table table-condensed">
                                            <thead>
                                                <tr>
                                                    <th class="o_pms_pwa_theme_color"></th>
                                                    <th class="o_pms_pwa_theme_color">ID</th>
                                                    <th class="o_pms_pwa_theme_color">Total(€)</th>
                                                    <th class="o_pms_pwa_theme_color">Nombre</th>
                                                    <th class="o_pms_pwa_theme_color">Tipo</th>
                                                    <th class="o_pms_pwa_theme_color">nº</th>
                                                </tr>

                                            </thead>
                                            <tbody>
                                                <t t-foreach="reservation.folio_id.reservation_ids" t-as="i">
                                                    <tr class="o_roomdoo_hide_show">
                                                        <td>
                                                            <input type="checkbox" name="reservation_ids" checked="checked" t-if="reservation.id == i.id" t-attf-value="{{ i.id }}" />
                                                            <input type="checkbox" name="reservation_ids" t-if="reservation.id != i.id" t-attf-value="{{ i.id }}" />
                                                        </td>
                                                        <td>
                                                            <a t-att-href="'/reservation/' + str(i.id)">
                                                                <t t-esc="i.name" />
                                                            </a>
                                                        </td>
                                                        <td class="text-right">
                                                            <t t-esc="i.price_total" />
                                                        </td>
                                                        <td>
                                                            <t t-esc="i.partner_id.name" />
                                                        </td>
                                                        <td class="text-right">
                                                            <t t-esc="i.room_type_id.default_code" />
                                                        </td>
                                                        <td>
                                                            <t t-esc="i.preferred_room_id.name" />
                                                        </td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>

                                        <div class="row">
                                            <div class="col-12 mt-2">
                                                <div class="o_roomdoo_hide_show-more">Ver más</div>
                                            </div>
                                        </div>

                                    </div>

                                </div>
                                <div class="card shadow">
                                    <div class="card-header bg-white o_pms_pwa_card_header">
                                        <h3 class="mb-0">
                                            HABITACIÓN
                                        </h3>
                                    </div>
                                    <div class="card-body">
                                        <form t-attf-action="/reservation/{{reservation.id}}" method="post" class="form-horizontal" id="reservation_detail">
                                            <div class="form-group form-field mt8">
                                                <div class="row">
                                                    <div class="col-sm-12">
                                                        <label class="control-label col-12" for="room_type">
                                                            <!-- <t t-esc="reservation.room_type_id.with_context(checkin=reservation.checkin, checkout=reservation.checkout, pricelist_id=1)._get_availability_rooms()"></t> -->
                                                            Tipo de habitación
                                                        </label>
                                                        <select class="form-control o_website_form_input o_domain_leaf_operator_select o_input" name="room_type">
                                                            <!-- <option name="room_type" t-att-value="reservation.room_type_id.id" selected="selected">
                                                                <t t-esc="reservation.room_type_id.name" />
                                                            </option> -->
                                                            <t t-foreach="reservation.room_type_id" t-as="i">
                                                                <option name="room_type" t-att-value="i.id" selected="selected" t-if="reservation.room_type_id.id == i.id">
                                                                    <t t-esc="i.name" />
                                                                </option>
                                                                <option name="room_type" t-att-value="i.id" t-if="reservation.preferred_room_id.id != i.id">
                                                                    <t t-esc="i.name" />
                                                                </option>
                                                            </t>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row mt-3">
                                                    <div class="col-6">
                                                        <label class="control-label col-12" for="room_number">
                                                            Nº de habitaciones
                                                        </label>
                                                        <select class="form-control o_website_form_input o_domain_leaf_operator_select o_input" name="room_number">
                                                            <!-- TODO Cambiar por? ._get_allowed_rooms(reservation.checkin, reservation.checkout, reservation.state) -->
                                                            <t t-foreach="reservation.allowed_room_ids" t-as="i">
                                                                <option name="room_number" t-att-value="i.id" selected="selected" t-if="reservation.preferred_room_id.id == i.id">
                                                                    <t t-esc="i.name" />
                                                                </option>
                                                                <option name="room_number" t-att-value="i.id" t-if="reservation.preferred_room_id.id != i.id">
                                                                    <t t-esc="i.name" />
                                                                </option>
                                                            </t>
                                                        </select>
                                                    </div>
                                                    <div class="col-6">
                                                        <button type="button" class="btn btn-message-form o_pms_pwa_button_assign_confirm" t-attf-url="/reservation/{{ reservation.id }}/assign">
                                                            <img src="/pms_pwa/static/img/svg/check-blanco.svg" alt="Confirm" title="Confirm" class="mr-1 pb-1" width="15" />
                                                            Confirmar
                                                        </button>

                                                    </div>
                                                </div>
                                                <div class="row mt-3">
                                                    <div class="col-6">
                                                        <label class="control-label col-12" for="adults">
                                                            Nº de personas
                                                        </label>
                                                        <input class="form-control" type="text" name="adults" t-att-value="reservation.adults" />
                                                    </div>
                                                    <div class="col-6">
                                                        <label class="control-label col-12" for="nights">
                                                            Nº de noches
                                                        </label>
                                                        <input class="form-control" disabled="disabled" type="text" name="nights" t-att-value="reservation.nights" />
                                                    </div>
                                                </div>
                                                <div class="row mt-3">
                                                    <div class="col-12">
                                                        <t t-if="lang and lang == 'es_ES'">
                                                            <t t-set="checkin_date" t-value="reservation.checkin.strftime('%d/%m/%Y')"/>
                                                            <t t-set="checkout_date" t-value="reservation.checkout.strftime('%d/%m/%Y')"/>
                                                        </t>
                                                        <t t-else="">
                                                            <t t-set="checkin_date" t-value="reservation.checkin.strftime('%m/%d/%Y')"/>
                                                            <t t-set="checkout_date" t-value="reservation.checkout.strftime('%m/%d/%Y')"/>
                                                        </t>
                                                        <label class="control-label col-12" for="range_check_date_detail_reservation">
                                                            Check in - Check out
                                                        </label>
                                                        <input class="form-control" type="text" name="range_check_date_detail_reservation" t-attf-value="{{ checkin_date }} - {{ checkout_date }}" />
                                                        <span class="o_pms_pwa_calendar_icon">
                                                            <!-- <span class="fa fa-calendar" /> -->
                                                            <img src="/pms_pwa/static/img/svg/calendario-azul.svg" alt="calendar icon" title="calendar" width="20" />
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="row mt-3">
                                                    <div class="col-6">
                                                        <input type="hidden" name="checkin" t-attf-value="{{ checkin_date }}" />
                                                        <input type="hidden" name="checkout" t-attf-value="{{ checkout_date }}" />
                                                        <label class="control-label col-12" for="check_in_hour">
                                                            Hora Check in
                                                        </label>
                                                        <input class="form-control" type="time" name="check_in_hour" t-att-value="reservation.arrival_hour" />
                                                    </div>
                                                    <div class="col-6">
                                                        <label class="control-label col-12" for="check_out_hour">
                                                            Hora Check out
                                                        </label>
                                                        <input class="form-control" type="time" name="check_out_hour" t-att-value="reservation.departure_hour" />
                                                    </div>
                                                </div>
                                                <div class="row mt-3">
                                                    <div class="col-sm-12">
                                                        <label class="control-label col-12" for="allowed_board_service_room_ids">
                                                            Tipo de reserva
                                                        </label>
                                                        <select class="form-control o_website_form_input o_domain_leaf_operator_select o_input" name="allowed_board_service_room_ids">
                                                            <option name="allowed_board_service_room_ids" t-foreach="reservation._get_allowed_board_service_room_ids()" t-as="key" t-att-value="key['id']">
                                                                <t t-esc="key['name']" />
                                                            </option>
                                                        </select>
                                                    </div>
                                                </div>

                                                <div class="row m-3" id="o_pms_pwa_services_line">

                                                    <t t-foreach="reservation.service_ids" t-as="i">
                                                        <input type="hidden" t-attf-name="o_pms_pwa_service_line_{{i.id}}" t-attf-value="{{i.id}}"/>
                                                        <div class="col-12">
                                                            <div class="form-check mt-2" t-if="i.service_line_ids">
                                                                <input class="o_pms_pwa_checkbox" type="checkbox" checked="checked" t-attf-data-service_id="{{i.id}}" t-attf-id="defaultCheck{{i.id}}" data-toggle='collapse' t-attf-data-target='#collapsediv{{i.id}}' aria-expanded="true" t-attf-aria-controls="collapsediv{{i.id}}" />
                                                                <label class="o_pms_pwa_checkbox_label" t-attf-for="defaultCheck{{i.id}}">
                                                                    <t t-esc="i.product_id.name" />
                                                                </label>
                                                                <div t-attf-id='collapsediv{{i.id}}' class='o_pms_pwa_collapse collapse show'>
                                                                    <div class="o_pms_pwa_collapse_content mt-3">
                                                                        <br />
                                                                        <table>
                                                                            <thead>
                                                                                <tr>
                                                                                    <th class="o_pms_pwa_detail_th">Fecha</th>
                                                                                    <th class="o_pms_pwa_detail_th">Cantidad</th>
                                                                                    <th class="o_pms_pwa_detail_th">Precio</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                <t t-foreach="i.service_line_ids" t-as="s" >
                                                                                    <tr t-attf-class="o_roomdoo_hide_show_service_{{i.id}}">
                                                                                        <td class="o_pms_pwa_detail_td">
                                                                                            <span t-field="s.date" />
                                                                                        </td>
                                                                                        <td class="o_pms_pwa_detail_td o_pms_pwa_td_rb">
                                                                                            <div class="o_pms_pwa_rb_box">
                                                                                                <div class="o_pms_pwa_rb">
                                                                                                    <div class="o_pms_pwa_rb_tab o_pms_pwa_rb_remove" t-attf-data-reservation-id="{{ reservation.id }}" t-attf-data-service-id="{{ i.id }}" t-attf-data-id="{{ s.id }}">
                                                                                                        <div class="o_pms_pwa_rb_spot">
                                                                                                            <span class="o_pms_pwa_rb_txt">
                                                                                                                X
                                                                                                            </span>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div class="o_pms_pwa_rb_tab o_pms_pwa_rb_tab_active">
                                                                                                        <div class="o_pms_pwa_rb_spot">
                                                                                                            <span t-attf-class="o_pms_pwa_rb_txt o_pms_pwa_rb_value_{{s.id}}">
                                                                                                                <t t-esc="s.day_qty" />
                                                                                                            </span>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div class="o_pms_pwa_rb_tab o_pms_pwa_rb_edit" data-toggle="modal" data-target="#o_pms_pwa_editModal" t-attf-data-reservation-id="{{ reservation.id }}" t-attf-data-service-id="{{ i.id }}" t-attf-data-id="{{ s.id }}">
                                                                                                        <div class="o_pms_pwa_rb_spot">
                                                                                                            <span class="o_pms_pwa_rb_txt">
                                                                                                                <i class="fa fa-edit"></i>
                                                                                                            </span>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <input type="number" t-attf-id="price_{{ i.id}}_{{ s.id }}" name="price" t-attf-value="{{s.price_unit}}" class="form-control o_pms_pwa_modal_number" />
                                                                                        </td>
                                                                                    </tr>
                                                                                </t>
                                                                            </tbody>
                                                                        </table>
                                                                        <br />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- <div class="form-check mt-2" t-if="i.service_line_ids==''">
                                                                <input class="o_pms_pwa_checkbox" type="checkbox" id="defaultCheck2" checked="checked" />
                                                                <label class="o_pms_pwa_checkbox_label" for="defaultCheck2">
                                                                    <t t-esc="i.product_id.name" />
                                                                </label>
                                                            </div> -->
                                                        </div>
                                                        <div class="col-12 mt-2">
                                                            <div class="o_roomdoo_hide_show-services-more o_roomdoo_hide_show-more2" t-attf-data-service-id="{{i.id}}">Ver más</div>
                                                        </div>
                                                    </t>
                                                </div>

                                                <div class="row mt-4">
                                                    <div class="col-sm-12">
                                                        <label class="control-label col-12" for="add_service">
                                                            Añadir servicio
                                                        </label>
                                                        <select class="form-control o_website_form_input o_domain_leaf_operator_select o_input" name="add_service">
                                                            <option t-foreach="reservation._get_allowed_service_ids()" t-as="key" t-att-value="key['id']">
                                                                <t t-esc="key['name']" />
                                                            </option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <hr class="o_pms_pwa_black_hr" />
                                                <div class="row mt-3">
                                                    <div class="col-12">
                                                        <h4>Observaciones</h4>
                                                        <div>
                                                            <p>Aut possimus enim molestiae eaque. Dicta suscipit ea ut. Enim qui dolor ut voluptatem odio corporis. Occaecati occaecati rerum aliquid. Eligendi expedita eligendi illo nisi ipsum a qui. Et aut est ut.…</p>
                                                        </div>
                                                    </div>
                                                    <div class="col-12 o_pms_pwa_selectpicker">
                                                        <!-- <label class="control-label col-12" for="allowed_segmentations">
                                                            Motivo del viaje
                                                        </label> -->
                                                        <!-- <select multiple="true" data-live-search="true" name="segmentation_ids"  class="selectpicker"> -->

                                                        <select multiple="true" data-style="form-control o_pms_pwa_multiselect" class="selectpicker w-100" data-live-search="true" name="segmentation_ids" title="Motivo del viaje" >
                                                            <!-- t-att-selected="reservation.service_ids in key['id'] ? 'selected' : None" -->
                                                            <option name="segmentation_ids" t-foreach="reservation._get_allowed_segmentations()" t-as="key" t-att-value="key['id']">
                                                                <t t-esc="key['name']" />
                                                            </option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <hr />
                                                <div class="row mt-3">
                                                    <div class="col-12">
                                                        <div class="form-group text-center">
                                                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                                                            <input type="submit" class="btn btn-message" value="GUARDAR CAMBIOS" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <div class="card shadow mt-4">
                                    <div class="card-header bg-white o_pms_pwa_card_header">
                                        <h3 class="mb-0">
                                            DETALLES DE LA TARIFA
                                        </h3>
                                    </div>
                                    <div class="card-body">
                                        <form action="#" method="post" class="form-horizontal">
                                            <div class="form-group form-field mt8">
                                                <div class="row">
                                                    <div class="col-sm-12">
                                                        <label class="control-label col-12" for="allowed_pricelists">
                                                            Tipo de tarifa
                                                        </label>
                                                        <select class="form-control o_website_form_input o_domain_leaf_operator_select o_input" name="allowed_pricelists">
                                                            <option name="allowed_pricelists" t-foreach="reservation._get_allowed_pricelists()" t-as="key" t-att-value="key['id']">
                                                                <t t-esc="key['name']" />
                                                            </option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row mt-2">
                                                    <div class="col-sm-12">
                                                        <h4 data-toggle="collapse" data-target="#collapse_price_nights">
                                                            <i class="fa fa-pencil-square-o" aria-hidden="false" />
                                                            Precio/Noche
                                                            <i class="fa fa-angle-down rotate-icon" />
                                                        </h4>
                                                        <div id="collapse_price_nights" class="collapse" aria-labelledby="headingOne">
                                                            <table class="table table-condensed">
                                                                <thead>

                                                                    <tr>
                                                                        <th class="o_pms_pwa_theme_color">Día</th>
                                                                        <th class="o_pms_pwa_theme_color">Precio</th>
                                                                        <th class="o_pms_pwa_theme_color">Descuento (%)</th>
                                                                    </tr>

                                                                </thead>
                                                                <tbody>
                                                                    <t t-foreach="reservation._get_reservation_line_ids()" t-as="i">
                                                                        <tr>
                                                                            <td>
                                                                                <t t-esc="i_value['date']" />
                                                                            </td>
                                                                            <td>
                                                                                <input type="number" name="precio" t-att-value="i_value['price']" class="form-control o_pms_pwa_modal_number" />
                                                                            </td>
                                                                            <td>
                                                                                <input type="number" name="descuento" t-att-value="i_value['discount']" class="form-control o_pms_pwa_modal_number" />
                                                                            </td>
                                                                        </tr>
                                                                    </t>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12 col-xl-4 mt-4" id="invoice_col">
                                <div class="card bg-dark shadow">
                                    <div class="card-header o_pms_pwa_card_header">
                                        <h3 class="mb-0">
                                            Detalles de pago
                                        </h3>
                                    </div>
                                    <div class="card-body bg-dark">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th class="o_pms_pwa_theme_color"></th>
                                                    <th class="o_pms_pwa_theme_color">concepto</th>
                                                    <th class="o_pms_pwa_theme_color text-right">a facturar</th>
                                                    <th class="o_pms_pwa_theme_color text-right">facturado/total</th>
                                                    <th class="o_pms_pwa_theme_color text-right">importe(€)</th>
                                                </tr>
                                            </thead>
                                            <tbody id="reservation_list"></tbody>
                                        </table>
                                        <!-- <div class="row">
                                            <div class="col-12">
                                                <div class="o_roomdoo_hide_show-more2">Show more</div>
                                            </div>
                                        </div> -->
                                        <div class="row pago-badge">
                                            <div class="col-4">
                                                <span>
                                                    Total
                                                    <br />
                                                    a facturar
                                                </span>
                                                <span class="pt" id="total_amount">
                                                    <t t-esc="reservation.folio_id.amount_total" />
                                                </span>
                                            </div>
                                            <div class="col-4">
                                                <span>
                                                    Total
                                                </span>
                                                <span class="price">
                                                    <t t-esc="reservation.folio_id.amount_total" />
                                                </span>
                                            </div>
                                            <div class="col-4">
                                                <span>
                                                    Pendiente
                                                    <br />
                                                    de pago
                                                </span>
                                                <span class="price2">
                                                    <t t-esc="reservation.folio_id.pending_amount" />
                                                </span>
                                            </div>
                                        </div>

                                            <hr class="m-1" />
                                            <!-- <div class="row pago-badge">
                                            <div class="col-12">Nº tarjeta reserva</div>
                                            <div class="col-12 num">
                                                <t t-esc="reservation.folio_id.credit_card_details" />
                                                **** **** **** 2545
                                            </div>
                                        </div> -->
                                            <div class="row m-1" id="facturacion">
                                                <div class="col-12">
                                                    <h4 data-toggle="collapse" data-target="#collapseDatos">
                                                        Datos de facturación
                                                        <i class="fa fa-angle-down o_pms_pwa_rotate-icon" />
                                                    </h4>
                                                    <div id="collapseDatos" class="collapse" aria-labelledby="headingOne" data-parent="#facturacion">
                                                        <div class="card-body">
                                                            <form target="_self" t-attf-action="/reservation/{{ reservation.id }}" method="post" class="form-horizontal">
                                                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                                                                <div class="form-group form-field mt8">
                                                                    <div class="row">
                                                                        <div class="col-sm-12">
                                                                            <label class="control-label col-12" for="rate_type">
                                                                            Invoice contact
                                                                        </label>
                                                                            <select class="form-control o_website_form_input o_domain_leaf_operator_select o_input" id="partner_to_invoice">
                                                                                <t t-foreach="reservation.folio_id.partner_invoice_ids" t-as="partner">
                                                                                    <t t-if="partner.id == reservation.folio_id.partner_id.id">
                                                                                        <option t-attf-value="{{ partner.id }}" selected="selected">
                                                                                            <t t-esc="partner.name"></t>
                                                                                        </option>
                                                                                    </t>
                                                                                    <t t-else="">
                                                                                        <option t-attf-value="{{ partner.id }}">
                                                                                            <t t-esc="partner.name"></t>
                                                                                        </option>
                                                                                    </t>
                                                                                </t>
                                                                                <option value="False">New contact</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                    <div class="row mt-2">
                                                                        <div class="col-sm-12">
                                                                            <label class="control-label col-12" for="rate_type">
                                                                            Name
                                                                        </label>
                                                                            <input class="form-control" type="text" name="invoice_name" t-attf-value="{{ reservation.folio_id.partner_id.name }}" />
                                                                        </div>
                                                                    </div>
                                                                    <div class="row mt-2">
                                                                        <div class="col-sm-12">
                                                                            <label class="control-label col-12" for="rate_type">
                                                                            NIF/CIF
                                                                        </label>
                                                                            <input class="form-control" type="text" name="invoice_vat" t-attf-value="{{ reservation.folio_id.partner_id.vat }}" required="required" />
                                                                        </div>
                                                                    </div>
                                                                    <div class="row mt-2">
                                                                        <div class="col-sm-12">
                                                                            <label class="control-label col-12" for="rate_type">
                                                                            Address
                                                                        </label>
                                                                            <input class="form-control" type="text" name="invoice_street" t-attf-value="{{ reservation.folio_id.partner_id.street }}" required="required" />
                                                                        </div>
                                                                    </div>
                                                                    <div class="row mt-2">
                                                                        <div class="col-sm-12">
                                                                            <label class="control-label col-12" for="rate_type">
                                                                            City
                                                                        </label>
                                                                            <input class="form-control" type="text" name="invoice_city" t-attf-value="{{ reservation.folio_id.partner_id.city }}" required="required" />
                                                                        </div>
                                                                    </div>
                                                                    <div class="row mt-2">
                                                                        <div class="col-sm-12">
                                                                            <label class="control-label col-12" for="rate_type">
                                                                            Postal code
                                                                        </label>
                                                                            <input class="form-control" type="text" name="invoice_postal_code" t-attf-value="{{ reservation.folio_id.partner_id.zip }}" required="required" />
                                                                        </div>
                                                                    </div>
                                                                    <div class="row mt-2">
                                                                        <div class="col-sm-12">
                                                                            <label class="control-label col-12" for="rate_type">
                                                                            Country
                                                                        </label>
                                                                            <input class="form-control" type="text" name="invoice_country" t-attf-value="{{ reservation.folio_id.partner_id.country_id.name }}" required="required" />
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!-- <input type="submit" class="btn btn-message" value="Actualizar" /> -->
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row m-1">
                                                <div class="col-12">
                                                    <h4>Métodos de pago</h4>
                                                </div>
                                                <div class="col-12">
                                                    <t t-foreach="reservation.folio_id.pms_property_id._get_payment_methods()" t-as="payment">

                                                        <div class="form-check mt-1">
                                                            <input type="radio" class="o_pms_pwa_checkbox" name="payment_method" t-attf-value="{{ payment.id }}" checked="checked" />
                                                            <!-- <input class="o_pms_pwa_checkbox" type="checkbox" t-attf-id="{{ payment.id }}" checked="checked" /> -->
                                                            <label class="o_pms_pwa_checkbox_label pl-1">
                                                                <t t-esc="payment.name"></t>
                                                            </label>
                                                        </div>

                                                    </t>
                                                </div>
                                            </div>

                                            <hr class="m-1" />
                                            <div class="col-12">
                                                <div class="form-group text-center">
                                                    <!-- <button class="btn btn-print">
                                                    <i class="fa fa-print" aria-hidden="false" />
                                                    IMPRIMIR
                                                </button> -->

                                                    <button id="payment_button" class="btn btn-message">
                                                        <i class="fa fa-file-text-o" aria-hidden="false" />
                                                        FACTURAR
                                                    </button>

                                                </div>
                                            </div>

                                    </div>
                                </div>
                                <t t-if="reservation.folio_id.invoice_count > 0">
                                    <div class="card bg-white shadow mt-4">
                                        <div class="card-header bg-white o_pms_pwa_card_header">
                                            <h3 class="mb-0">
                                                Facturas
                                            </h3>
                                        </div>
                                        <div class="card-body bg-white o_pms_pwa_table_reservation_list">
                                            <table class="table">
                                                <thead>

                                                    <tr>
                                                        <th class="o_pms_pwa_theme_color">ID</th>
                                                        <th class="o_pms_pwa_theme_color">Partner</th>
                                                        <th class="o_pms_pwa_theme_color">Date</th>
                                                        <th class="o_pms_pwa_theme_color">Total</th>
                                                    </tr>

                                                </thead>
                                                <tbody>
                                                    <t t-foreach="reservation.folio_id.move_ids" t-as="i">
                                                        <tr>
                                                            <td>
                                                                <a class="o_pms_pwa_theme_color" t-att-href="'/my/invoices/' + str(i.id)">
                                                                    <t t-esc="i.name" />
                                                                </a>
                                                            </td>
                                                            <td class="black_text">
                                                                <t t-esc="i.partner_id.name" />
                                                            </td>
                                                            <td class="black_text text-right">
                                                                <t t-esc="i.invoice_date" />
                                                            </td>
                                                            <td class="black_text text-right">
                                                                <t t-esc="i.amount_total" />
                                                            </td>

                                                        </tr>
                                                    </t>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

        </t>
    </template>
</odoo>
